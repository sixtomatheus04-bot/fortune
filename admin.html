<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel GOD MODE - Fortune Bet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0a192f; color: white; display: flex; margin: 0; }
        
        /* Sidebar */
        .sidebar { width: 250px; background: #112240; height: 100vh; padding: 20px; border-right: 1px solid #d4af37; }
        .sidebar h2 { color: #d4af37; text-align: center; }
        .menu-item { padding: 15px; cursor: pointer; border-radius: 10px; margin-bottom: 5px; transition: 0.3s; }
        .menu-item:hover, .menu-item.active { background: #d4af37; color: #0a192f; font-weight: bold; }
        
        /* Conte√∫do Principal */
        .content { flex: 1; padding: 40px; overflow-y: auto; }
        .section { display: none; } /* Esconde tudo por padr√£o */
        .section.active { display: block; } /* Mostra s√≥ o ativo */

        /* Tabelas */
        table { width: 100%; border-collapse: collapse; background: #112240; border-radius: 10px; overflow: hidden; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #233554; }
        th { background: #233554; color: #d4af37; }
        
        /* Bot√µes e Inputs */
        button { cursor: pointer; padding: 8px 15px; border-radius: 5px; border: none; font-weight: bold; }
        .btn-add { background: #4dff88; color: #0a192f; }
        .btn-reply { background: #d4af37; color: #0a192f; }
        input { padding: 8px; border-radius: 5px; border: none; }
        
        /* Cards de Chat */
        .chat-card { background: #112240; padding: 15px; margin-bottom: 10px; border-radius: 10px; border-left: 4px solid #d4af37; }
        .reply-area { display: none; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>üëë ADMIN</h2>
        <div class="menu-item active" onclick="show('dashboard')"><i class="fas fa-chart-line"></i> Dashboard (RTP)</div>
        <div class="menu-item" onclick="show('usuarios')"><i class="fas fa-users"></i> Usu√°rios & Saldo</div>
        <div class="menu-item" onclick="show('suporte')"><i class="fas fa-headset"></i> Suporte Ao Vivo</div>
        <div class="menu-item" onclick="window.location.href='index.html'" style="margin-top: 50px; border: 1px solid #ff4d4d; color: #ff4d4d;">Sair do Painel</div>
    </div>

    <div class="content">
        <div id="dashboard" class="section active">
            <h1>Controle da Casa</h1>
            <div style="background: #112240; padding: 30px; border-radius: 15px; max-width: 400px;">
                <h3>RTP (Chance de Vit√≥ria)</h3>
                <p>Quanto maior, mais os jogadores ganham.</p>
                <input type="number" id="rtp-input" style="width: 80px; font-size: 1.5em;"> %
                <button onclick="mudarRTP()" style="background: #d4af37; font-size: 1.2em;">Salvar</button>
            </div>
        </div>

        <div id="usuarios" class="section">
            <h1>Gest√£o de Usu√°rios</h1>
            <p>Adicione saldo para testes ou b√¥nus.</p>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Saldo Atual</th>
                        <th>A√ß√£o</th>
                    </tr>
                </thead>
                <tbody id="lista-users">
                    </tbody>
            </table>
        </div>

        <div id="suporte" class="section">
            <h1>Suporte ao Jogador</h1>
            <button onclick="carregarChat()" style="margin-bottom: 15px;">üîÑ Atualizar Mensagens</button>
            <div id="lista-chat">
                </div>
        </div>
    </div>

    <script>
        const API_URL = ''; // Vercel

        // Troca de abas
        function show(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            if(id === 'usuarios') carregarUsuarios();
            if(id === 'suporte') carregarChat();
            if(id === 'dashboard') carregarRTP();
        }

        // --- DASHBOARD ---
        async function carregarRTP() {
            const req = await fetch(`${API_URL}/admin/stats`);
            const dados = await req.json();
            document.getElementById('rtp-input').value = dados.rtp;
        }
        async function mudarRTP() {
            const val = document.getElementById('rtp-input').value;
            await fetch(`${API_URL}/admin/mudar-rtp`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ novoRtp: val }) });
            alert("RTP Atualizado!");
        }

        // --- USU√ÅRIOS ---
        async function carregarUsuarios() {
            const req = await fetch(`${API_URL}/admin/usuarios`);
            const users = await req.json();
            const lista = document.getElementById('lista-users');
            lista.innerHTML = '';

            users.forEach(u => {
                lista.innerHTML += `
                    <tr>
                        <td>${u.id}</td>
                        <td>${u.nome}</td>
                        <td>${u.email}</td>
                        <td style="color: #4dff88; font-weight: bold;">R$ ${u.saldo.toFixed(2)}</td>
                        <td>
                            <button class="btn-add" onclick="darDinheiro('${u.email}')">+ R$ 100</button>
                            <button style="background: #ff4d4d; color: white;" onclick="tirarDinheiro('${u.email}')">- R$ 100</button>
                        </td>
                    </tr>
                `;
            });
        }

        async function darDinheiro(email) {
            if(!confirm(`Adicionar R$ 100 para ${email}?`)) return;
            await fetch(`${API_URL}/admin/saldo`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ email, valor: 100 }) });
            carregarUsuarios();
        }
        
        async function tirarDinheiro(email) {
            await fetch(`${API_URL}/admin/saldo`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ email, valor: -100 }) });
            carregarUsuarios();
        }

        // --- CHAT SUPORTE ---
        async function carregarChat() {
            const req = await fetch(`${API_URL}/chat/todas`);
            const msgs = await req.json();
            const div = document.getElementById('lista-chat');
            div.innerHTML = '';

            msgs.forEach(m => {
                const status = m.respondido ? '<span style="color:#4dff88">[RESPONDIDO]</span>' : '<span style="color:#ff4d4d">[NOVA]</span>';
                div.innerHTML += `
                    <div class="chat-card">
                        <small style="color: #8892b0;">${m.email_usuario} - ${m.data}</small>
                        <p style="font-size: 1.1em;">"${m.mensagem}"</p>
                        <p style="color: #d4af37;">Resposta atual: ${m.resposta || "Nenhuma"}</p>
                        ${status}
                        <br>
                        <button class="btn-reply" onclick="abrirResposta(${m.id})">Responder</button>
                        <div id="resp-${m.id}" class="reply-area">
                            <input type="text" id="input-${m.id}" placeholder="Digite a resposta..." style="width: 70%;">
                            <button onclick="enviarResposta(${m.id})">Enviar</button>
                        </div>
                    </div>
                `;
            });
        }

        function abrirResposta(id) {
            document.getElementById(`resp-${id}`).style.display = 'block';
        }

        async function enviarResposta(id) {
            const resp = document.getElementById(`input-${id}`).value;
            await fetch(`${API_URL}/chat/responder`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ id, resposta: resp }) });
            alert("Respondido!");
            carregarChat();
        }

        // Inicia
        carregarRTP();
    </script>
</body>
</html>
